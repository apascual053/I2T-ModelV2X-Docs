<!doctype html>
<html class="no-js" lang="es" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Índice" href="genindex.html" /><link rel="search" title="Búsqueda" href="search.html" /><link rel="prev" title="Comunicación básica y personalizada" href="basic.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Entiendo data_transmitter_main.c - documentación de Maqueta V2X - 0.1</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">documentación de Maqueta V2X - 0.1</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">documentación de Maqueta V2X - 0.1</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Búsqueda" name="q" aria-label="Búsqueda">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="project.html">El proyecto</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="unex.html">Los módulos Unex</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Los módulos Unex</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="unex-overview.html">Descripción general</a></li>
<li class="toctree-l2"><a class="reference internal" href="unex-v2xcast.html">V2Xcast</a></li>
<li class="toctree-l2"><a class="reference internal" href="unex-j2735.html">J2735</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="batman.html">B.A.T.M.A.N.</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic.html">Comunicación básica y personalizada</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Entiendo <cite>data_transmitter_main.c</cite></a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/data-transmitter.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="entiendo-data-transmitter-main-c">
<h1>Entiendo <cite>data_transmitter_main.c</cite><a class="headerlink" href="#entiendo-data-transmitter-main-c" title="Link to this heading">¶</a></h1>
<p>En esta página se describe la composición y definición del script <code class="docutils literal notranslate"><span class="pre">data_transmitter_main.c</span></code>. Este script es utilizado para la transmisión personalizada de un string en una comunicación V2X. Para más información leer el apartado <a class="reference internal" href="basic.html"><span class="doc">Comunicación básica y personalizada</span></a>.</p>
<p>Este código está escrito es lenguaje <code class="docutils literal notranslate"><span class="pre">C</span></code>.</p>
<section id="cabecera">
<h2>Cabecera<a class="headerlink" href="#cabecera" title="Link to this heading">¶</a></h2>
<p>En primer lugar se incluyen directivas de pre-procesado para:</p>
<ul class="simple">
<li><p>Extensiones especificas de GNU (más allá de POSIX)</p></li>
<li><p>Hilos</p></li>
<li><p>Señales</p></li>
<li><p>Flujos de entrada y salida</p></li>
<li><p>Cadenas de caracteres</p></li>
<li><p>Constantes y funciones de bajo nivel</p></li>
<li><p>Funciones estándar de propósito general</p></li>
<li><p>Manipulación y medición del tiempo</p></li>
<li><p>Funciones específicas para manejo del tiempo</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define _GNU_SOURCE</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pthread.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;signal.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;time.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/time.h&gt;</span>
</pre></div>
</div>
<p>Después, incluye dos archivos de cabecera personalizados. Estos permite hacer uso de la API del SDK de los módulos Unex utilizados en este proyecto.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;us_caster_service.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;error_code_user.h&quot;</span>
</pre></div>
</div>
<p>A continuación, encontramos la definición de macros.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define MAX_BUFFER_SIZE 1024</span>
</pre></div>
</div>
<p>El código define varios tipos de datos para mejorar la legibilidad y organización del script. Entre ellos se encuentran:</p>
<ul class="simple">
<li><p>Tipos de datos de aplicación: usados para controlar el estado de la aplicación.</p></li>
<li><p>Tipos de datos de hilo: determinan el rol de transmisión o recepción, activando diferentes partes del código según el caso.</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">app_state_type</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">APP_STATE_DESTROY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">APP_STATE_INITIAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">APP_STATE_READY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="p">}</span><span class="w"> </span><span class="n">app_state_type_t</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">app_thread_type</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">APP_THREAD_TX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">APP_THREAD_RX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="p">}</span><span class="w"> </span><span class="n">app_thread_type_t</span><span class="p">;</span>
</pre></div>
</div>
<p>La sección de cabecera concluye con la declaración de varias variables globales:</p>
<ul class="simple">
<li><p>Inicialización de un tipo de dato de aplicación</p></li>
<li><p>Un <code class="docutils literal notranslate"><span class="pre">caster_handler</span></code> inicializado con un valor no valido.</p></li>
<li><p>Un puntero <code class="docutils literal notranslate"><span class="pre">char</span></code> que apunta a ID del caster.</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">app_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APP_STATE_INITIAL</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="n">caster_handler_t</span><span class="w"> </span><span class="n">caster_handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">INVALID_CASTER_HANDLER</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">caster_rx_id</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="funciones">
<h2>Funciones<a class="headerlink" href="#funciones" title="Link to this heading">¶</a></h2>
<section id="leer-input-del-usuario">
<h3>Leer input del usuario<a class="headerlink" href="#leer-input-del-usuario" title="Link to this heading">¶</a></h3>
<p>La función <code class="docutils literal notranslate"><span class="pre">read_user_input()</span></code> recibe como parámetros:</p>
<ul class="simple">
<li><p>Un puntero <code class="docutils literal notranslate"><span class="pre">char</span></code> que apunta al comienzo del buffer con el contenido proporcionado.</p></li>
<li><p>Longitud máxima.</p></li>
</ul>
<p>El funcionamiento es el siguiente:</p>
<ul class="simple">
<li><p>Se le solicita un input de tipo <code class="docutils literal notranslate"><span class="pre">string</span></code> y comprueba que no este a <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</p>
<ul>
<li><p>En caso de <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, genera un error y termina la ejecución del programa.</p></li>
</ul>
</li>
<li><p>Si el <code class="docutils literal notranslate"><span class="pre">string</span></code> proporcionado contiene el carácter <code class="docutils literal notranslate"><span class="pre">\n</span></code> , se elimina.</p>
<ul>
<li><p>En consecuencia, se decrementa su longitud <code class="docutils literal notranslate"><span class="pre">input_length</span></code>.</p></li>
</ul>
</li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">read_user_input</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">input_buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">max_length</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Enter a string: &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">input_buffer</span><span class="p">,</span><span class="w"> </span><span class="n">max_length</span><span class="p">,</span><span class="w"> </span><span class="n">stdin</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error reading input.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Remove trailing newline if present</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">input_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">input_buffer</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input_length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">input_buffer</span><span class="p">[</span><span class="n">input_length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">input_buffer</span><span class="p">[</span><span class="n">input_length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="n">input_length</span><span class="o">--</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">input_length</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="transmision-de-la-informacion">
<h3>Transmisión de la información<a class="headerlink" href="#transmision-de-la-informacion" title="Link to this heading">¶</a></h3>
<p>La función <code class="docutils literal notranslate"><span class="pre">transmit_data()</span></code> es la que función que, haciendo uso de la API del SDK de los módulos Unex, envía la información. Concretamente, hace uso de la función <code class="docutils literal notranslate"><span class="pre">us_caster_tx()</span></code> para transmitir la información.</p>
<p>Recibe como parámetros un puntero a <code class="docutils literal notranslate"><span class="pre">data</span></code>.</p>
<p>El funcionamiento es el siguiente:</p>
<ul class="simple">
<li><p>Obtiene la longitud de la cadena a transmitir</p></li>
<li><p>Desplaza todos los caracteres una posición a la derecha</p></li>
<li><p>Añade información sobre ID del caster</p>
<ul>
<li><p>Un byte inicial al principio de <code class="docutils literal notranslate"><span class="pre">data</span></code>.</p></li>
<li><p>Un símbolo <code class="docutils literal notranslate"><span class="pre">%</span></code> al final de <code class="docutils literal notranslate"><span class="pre">data</span></code>. Para ello, desplazada una posición a la derecha el símbolo de final de <code class="docutils literal notranslate"><span class="pre">string</span></code> (<code class="docutils literal notranslate"><span class="pre">\0</span></code>).</p></li>
</ul>
</li>
<li><p>Hace uso de <code class="docutils literal notranslate"><span class="pre">us_caster_tx()</span></code></p>
<ul>
<li><p>En caso de error, notifica el estado por pantalla y termina la ejecución del programa.</p></li>
<li><p>En ausencia de error, notifica la transmisión de <code class="docutils literal notranslate"><span class="pre">data</span></code> por pantalla.</p></li>
</ul>
</li>
<li><p>Por último, bloquea la ejecución del programa durante 100 ms, para dar tiempo al receptor a procesar la información</p></li>
</ul>
<p>Si todo se ha ejecutado correctamente, se vuelve un <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">transmit_data</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w"> </span><span class="c1">// Obtener la longitud actual de la cadena</span>

<span class="w">    </span><span class="c1">// Desplazar todos los caracteres a la derecha para hacer espacio para el nuevo carácter</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Añadir el id del caster</span>
<span class="w">    </span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">caster_rx_id</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="w">    </span><span class="n">data</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;%&#39;</span><span class="p">;</span>
<span class="w">    </span><span class="n">data</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">us_caster_tx</span><span class="p">(</span><span class="n">caster_handler</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">data</span><span class="p">));</span><span class="w"> </span><span class="c1">//API SDK envio de data</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">IS_SUCCESS</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error transmitting data: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Character transmitted: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>

<span class="w">    </span><span class="n">usleep</span><span class="p">(</span><span class="mi">100000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Sleep for 100 ms between transmissions</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="funcion-de-recepcion-de-senales">
<h3>Función de recepción de señales<a class="headerlink" href="#funcion-de-recepcion-de-senales" title="Link to this heading">¶</a></h3>
<p>La función <code class="docutils literal notranslate"><span class="pre">app_signal_handler()</span></code>  es la función que se encarga de manejar las señales del programa. En concreto, las señales <code class="docutils literal notranslate"><span class="pre">SIGINT</span></code> y <code class="docutils literal notranslate"><span class="pre">SIGTERM</span></code>. La primera de ellas hace referencia a una señal típicamente generada cuando el usuario pulsa <code class="docutils literal notranslate"><span class="pre">Ctrl+C</span></code>. La segunda, es la señal estándar de solicitud de finalización del programa.</p>
<p>Cuando se recibe alguna de estas señales, el programa notifica que procede a la finalización y cambia el estado a <code class="docutils literal notranslate"><span class="pre">APP_STATE_DESTROY</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">app_signal_handler</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sig_num</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sig_num</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SIGINT</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">sig_num</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SIGTERM</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Received signal %d, shutting down...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sig_num</span><span class="p">);</span>
<span class="w">        </span><span class="n">app_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APP_STATE_DESTROY</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="configuracion-de-recepcion-de-senales-con-pila-alternativa">
<h3>Configuración de recepción de señales con pila alternativa<a class="headerlink" href="#configuracion-de-recepcion-de-senales-con-pila-alternativa" title="Link to this heading">¶</a></h3>
<p>La función <code class="docutils literal notranslate"><span class="pre">app_setup_signals()</span></code> se utiliza para configurar la recepción de señales mediante una pila alternativa y a través de la función <code class="docutils literal notranslate"><span class="pre">app_signal_handler()</span></code>.</p>
<p>En primer lugar, se declaran las siguientes variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">stack_t</span> <span class="pre">sigstack</span></code>: Una estructura que se usa para el manejo de pilas (espacio de memoria) en las señales. Normalmente, una pila separada evita conflictos con otras pilas del sistema.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">sigaction</span> <span class="pre">sa</span></code>: Una estructura que define cómo manejar las señales.</p></li>
<li><p>El valor de retorno en forma de <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">ret</span></code>.</p></li>
</ul>
<p>El funcionamiento es el siguiente:</p>
<ul class="simple">
<li><p>Reserva de espacio para la pila de memoria alternativa (<code class="docutils literal notranslate"><span class="pre">malloc</span></code>):</p>
<ul>
<li><p>En caso de que no se pueda realizar esta tarea, se finaliza la ejecución del programa.</p></li>
</ul>
</li>
<li><p>Configuración de la pila alternativa:</p>
<ul>
<li><p>Se indica que la pila tiene tamaño <code class="docutils literal notranslate"><span class="pre">SIGSTKSZ</span></code>, un valor estándar para el manejo de pilas
alternativas en el contexto de manejo de señales.</p></li>
<li><p>Como la pila se usará de manera estándar, se añade <code class="docutils literal notranslate"><span class="pre">sigstack.ss_flags</span> <span class="pre">=</span> <span class="pre">0</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sigaltstack(&amp;sigstack,</span> <span class="pre">NULL)</span></code> indica al sistema que use la pila alternativa
(<code class="docutils literal notranslate"><span class="pre">sigstack</span></code>) que hemos preparado para manejar las señales.</p>
<ul>
<li><p>Si no se puede configurar, se procede a finalizar la ejecución de la función
y se devolverá el valor que <code class="docutils literal notranslate"><span class="pre">ret</span></code> tenga en ese instante.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Configuración del manejador de señales, para lo cual, lo primero que se ha hecho es definir <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">sigaction</span> <span class="pre">sa</span></code>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sa.sa_handler</span></code> especifica cuál es la función que se debe ejecutar cuando
se recibe una señal. En este caso, la función <code class="docutils literal notranslate"><span class="pre">app_signal_handler</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sa.sa_flags</span> <span class="pre">=</span> <span class="pre">SA_ONSTACK</span></code> indica que la señal se manejará usando una pila alternativa
previamente configurada con <code class="docutils literal notranslate"><span class="pre">sigaltstack</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sigemptyset(&amp;sa.sa_mask)</span></code> configura una máscara de señales, es decir, define qué señales
deben ser bloqueadas mientras se maneja la señal actual. Aquí, no estamos bloqueando ninguna señal
(ya que la función <code class="docutils literal notranslate"><span class="pre">sigemptyset()</span></code> vacía la máscara de señales), por lo que todas las señales
pueden ser procesadas.</p></li>
</ul>
</li>
<li><p>Registro de las señales que se deben manejar:</p>
<ul>
<li><p>Se registra la señal <code class="docutils literal notranslate"><span class="pre">SIGINT</span></code> mediante <code class="docutils literal notranslate"><span class="pre">sigaction(SIGINT,</span> <span class="pre">&amp;sa,</span> <span class="pre">NULL)</span></code>.</p></li>
<li><p>Se registra la señal <code class="docutils literal notranslate"><span class="pre">SIGTERM</span></code> mediante <code class="docutils literal notranslate"><span class="pre">sigaction(SIGTERM,</span> <span class="pre">&amp;sa,</span> <span class="pre">NULL)</span></code>.</p></li>
</ul>
</li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">app_setup_signals</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">stack_t</span><span class="w"> </span><span class="n">sigstack</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">sigaction</span><span class="w"> </span><span class="n">sa</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>

<span class="w">    </span><span class="n">sigstack</span><span class="p">.</span><span class="n">ss_sp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">SIGSTKSZ</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sigstack</span><span class="p">.</span><span class="n">ss_sp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">sigstack</span><span class="p">.</span><span class="n">ss_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SIGSTKSZ</span><span class="p">;</span>
<span class="w">    </span><span class="n">sigstack</span><span class="p">.</span><span class="n">ss_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sigaltstack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sigstack</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">perror</span><span class="p">(</span><span class="s">&quot;sigaltstack()&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">END</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">sa</span><span class="p">.</span><span class="n">sa_handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app_signal_handler</span><span class="p">;</span>
<span class="w">    </span><span class="n">sa</span><span class="p">.</span><span class="n">sa_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SA_ONSTACK</span><span class="p">;</span>
<span class="w">    </span><span class="n">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sa</span><span class="p">.</span><span class="n">sa_mask</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sigaction</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">perror</span><span class="p">(</span><span class="s">&quot;sigaction()&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">END</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sigaction</span><span class="p">(</span><span class="n">SIGTERM</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sa</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">perror</span><span class="p">(</span><span class="s">&quot;sigaction()&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">END</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="nl">END</span><span class="p">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="desactivacion-y-limpieza-de-recursos-asociados-a-la-recepcion-de-senales-con-pila-alternativa">
<h3>Desactivación y limpieza de recursos asociados a la recepción de señales con pila alternativa<a class="headerlink" href="#desactivacion-y-limpieza-de-recursos-asociados-a-la-recepcion-de-senales-con-pila-alternativa" title="Link to this heading">¶</a></h3>
<p>La función <code class="docutils literal notranslate"><span class="pre">app_teardown_signal()</span></code>, al contrario que la anterior, se utiliza para desactivar y liberar la pila alternativa configurada para señales. En ella se limpian los recursos usados por <code class="docutils literal notranslate"><span class="pre">sigaltstack</span></code>.</p>
<p>El funcionamiento es el siguiente:</p>
<ul class="simple">
<li><p>Obtención de la pila alternativa actual:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sigaltstack(NULL,</span> <span class="pre">&amp;sigstack)</span></code> obtiene la configuración actual de la pila de señales
(si está activa o no) y guarda su información en la estructura <code class="docutils literal notranslate"><span class="pre">sigstack</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sigstack.ss_sp</span></code> apunta a la memoria reservada para la pila alternativa. Esto se guarda en
<code class="docutils literal notranslate"><span class="pre">allocated_stack</span></code> para luego liberarla.</p></li>
</ul>
</li>
<li><p>Desactivación de la pila alternativa:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">sigstack.ss_sp</span> <span class="pre">=</span> <span class="pre">NULL</span></code> quita el puntero de la pila alternativa, dejando claro que ya no se usará.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sigstack.ss_flags</span> <span class="pre">=</span> <span class="pre">SS_DISABLE</span></code> indica al sistema que desactive el uso de la pila alternativa
para manejar señales.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sigaltstack(&amp;sigstack,</span> <span class="pre">NULL)</span></code> aplica estos cambios, desactivando oficialmente la pila alternativa.</p></li>
</ul>
</li>
<li><p>Liberación de la memoria reservada:</p>
<ul>
<li><p>Libera la memoria previamente reservada para la pila alternativa con <code class="docutils literal notranslate"><span class="pre">malloc()</span></code> en <code class="docutils literal notranslate"><span class="pre">app_setup_signals</span></code>.</p></li>
</ul>
</li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">app_teardown_signal</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">stack_t</span><span class="w"> </span><span class="n">sigstack</span><span class="p">;</span>
<span class="w">    </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">allocated_stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Get the signal stack pointer so we can free the memory */</span>
<span class="w">    </span><span class="n">sigaltstack</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sigstack</span><span class="p">);</span>
<span class="w">    </span><span class="n">allocated_stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">sigstack</span><span class="p">.</span><span class="n">ss_sp</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Tell the kernel to stop using it */</span>
<span class="w">    </span><span class="n">sigstack</span><span class="p">.</span><span class="n">ss_sp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">sigstack</span><span class="p">.</span><span class="n">ss_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SS_DISABLE</span><span class="p">;</span>
<span class="w">    </span><span class="n">sigstack</span><span class="p">.</span><span class="n">ss_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SIGSTKSZ</span><span class="p">;</span>
<span class="w">    </span><span class="n">sigaltstack</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sigstack</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Free old stack */</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">allocated_stack</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="configuracion-del-nombre-y-prioridad-del-hilo">
<h3>Configuración del nombre y prioridad del hilo<a class="headerlink" href="#configuracion-del-nombre-y-prioridad-del-hilo" title="Link to this heading">¶</a></h3>
<p>La función <code class="docutils literal notranslate"><span class="pre">pp_set_thread_name_and_priority()</span></code> establece el nombre y la prioridad de un hilo según su tipo (TX o RX).</p>
<ul class="simple">
<li><p>Verifica si el nombre del hilo (<code class="docutils literal notranslate"><span class="pre">p_name</span></code>) es <code class="docutils literal notranslate"><span class="pre">NULL</span></code>. Si es así, retorna <code class="docutils literal notranslate"><span class="pre">-1</span></code>.</p></li>
<li><p>Obtiene los límites de prioridad para los hilos de transmisión (TX) y recepción (RX).</p></li>
<li><p>Valida que la prioridad esté dentro de los límites permitidos según el tipo de hilo:</p>
<ul>
<li><p>Para hilos de transmisión (<code class="docutils literal notranslate"><span class="pre">APP_THREAD_TX</span></code>), se verifica que la prioridad esté en el rango permitido para TX.</p></li>
<li><p>Para hilos de recepción (<code class="docutils literal notranslate"><span class="pre">APP_THREAD_RX</span></code>), se verifica que la prioridad esté en el rango permitido para RX.</p></li>
</ul>
</li>
<li><p>Si el tipo de hilo no es reconocido, retorna <code class="docutils literal notranslate"><span class="pre">-1</span></code>.</p></li>
<li><p>Establece el nombre del hilo usando <cite>pthread_setname_np()</cite>. Si falla, retorna <code class="docutils literal notranslate"><span class="pre">-1</span></code>.</p></li>
<li><p>Si se permite la configuración de prioridades (<code class="docutils literal notranslate"><span class="pre">__SET_PRIORITY__</span></code>), se establece la prioridad del hilo usando <code class="docutils literal notranslate"><span class="pre">pthread_setschedparam()</span></code>. Si falla, retorna <code class="docutils literal notranslate"><span class="pre">-1</span></code>.</p></li>
<li><p>Retorna <code class="docutils literal notranslate"><span class="pre">0</span></code> en caso de éxito.</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="nf">app_set_thread_name_and_priority</span><span class="p">(</span><span class="n">pthread_t</span><span class="w"> </span><span class="kr">thread</span><span class="p">,</span><span class="w"> </span><span class="n">app_thread_type_t</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">p_name</span><span class="p">,</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">priority</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">caster_thread_info_t</span><span class="w"> </span><span class="n">limited_thread_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>

<span class="cp">#ifdef __SET_PRIORITY__</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SCHED_FIFO</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">sched_param</span><span class="w"> </span><span class="n">param</span><span class="p">;</span>
<span class="cp">#endif  </span><span class="c1">// __SET_PRIORITY__</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/* Check thread priority is in the limited range */</span>
<span class="w">    </span><span class="n">us_caster_thread_info_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">limited_thread_config</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">APP_THREAD_TX</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/* Check the limited range for tx thread priority */</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">priority</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">limited_thread_config</span><span class="p">.</span><span class="n">tx_thread_priority_low</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">priority</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">limited_thread_config</span><span class="p">.</span><span class="n">tx_thread_priority_high</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="cm">/* Thread priority is out of range */</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;The tx thread priority is out of range (%d-%d): %d </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">limited_thread_config</span><span class="p">.</span><span class="n">tx_thread_priority_low</span><span class="p">,</span><span class="w"> </span><span class="n">limited_thread_config</span><span class="p">.</span><span class="n">tx_thread_priority_high</span><span class="p">,</span><span class="w"> </span><span class="n">priority</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="cp">#ifdef __SET_PRIORITY__</span>
<span class="w">        </span><span class="n">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SCHED_RR</span><span class="p">;</span>
<span class="cp">#endif  </span><span class="c1">// __SET_PRIORITY__</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">APP_THREAD_RX</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/* Check the limited range for rx thread priority */</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">priority</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">limited_thread_config</span><span class="p">.</span><span class="n">rx_thread_priority_low</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">priority</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">limited_thread_config</span><span class="p">.</span><span class="n">rx_thread_priority_high</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="cm">/* Thread priority is out of range */</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;The rx thread priority is out of range (%d-%d): %d </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">limited_thread_config</span><span class="p">.</span><span class="n">rx_thread_priority_low</span><span class="p">,</span><span class="w"> </span><span class="n">limited_thread_config</span><span class="p">.</span><span class="n">rx_thread_priority_high</span><span class="p">,</span><span class="w"> </span><span class="n">priority</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="cm">/* Target thread type is unknown */</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;The thread type is unknown: %d </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pthread_setname_np</span><span class="p">(</span><span class="kr">thread</span><span class="p">,</span><span class="w"> </span><span class="n">p_name</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Can&#39;t set thread name: %d (%s)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">strerror</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="cp">#ifdef __SET_PRIORITY__</span>
<span class="w">    </span><span class="n">param</span><span class="p">.</span><span class="n">sched_priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">priority</span><span class="p">;</span>
<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pthread_setschedparam</span><span class="p">(</span><span class="kr">thread</span><span class="p">,</span><span class="w"> </span><span class="n">policy</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">param</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Can&#39;t set thread priority: %d (%s)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">strerror</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="cp">#endif  </span><span class="c1">// __SET_PRIORITY__</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="funcion-principal">
<h2>Función principal<a class="headerlink" href="#funcion-principal" title="Link to this heading">¶</a></h2>
<p>En primer lugar, después de haber declarado alguna variables generales, se desactiva el buffer de <code class="docutils literal notranslate"><span class="pre">stdout</span></code>  de tal forma que se presenta todo en pantalla sin esperar a completar o rellenar dicho buffer.</p>
<section id="invocar-el-programa">
<h3>Invocar el programa<a class="headerlink" href="#invocar-el-programa" title="Link to this heading">¶</a></h3>
<p>En segundo lugar, se verifica la correcta llamada al programa. Esta precisa de tres argumento: el nombre del programa, la dirección IP a la que se enviará la información, y el ID receptor del caster).</p>
<p>En caso de que esta llamada no se haga correctamente, se procede a la finalización del programa.</p>
<p>En el caso de haberse realizado correctamente la llamada, se asigna a <code class="docutils literal notranslate"><span class="pre">caster_rx_id</span></code> el tercer parámetro (de índice <code class="docutils literal notranslate"><span class="pre">2</span></code> ) pasado por consola.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  ./data_transmitter [IP] [caster_rx_id] </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  For example,</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;    ./data_transmitter 192.168.1.3 1&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">caster_rx_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</pre></div>
</div>
</section>
<section id="configuracion-de-las-senales">
<h3>Configuración de las señales<a class="headerlink" href="#configuracion-de-las-senales" title="Link to this heading">¶</a></h3>
<p>En tercer lugar, se configura el sistema para hacer uso de la pila alternativa durante el manejo de señales a través de la función <code class="docutils literal notranslate"><span class="pre">app_setup_signals()</span></code>.</p>
<p>En caso de no haberse podido realizar correctamente, se procede a presentar el fallo por pantalla y a terminar la ejecución del problema.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app_setup_signals</span><span class="p">();</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Failed to set up signals</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="configuracion-e-inicializacion-del-caster">
<h3>Configuración e inicialización del caster<a class="headerlink" href="#configuracion-e-inicializacion-del-caster" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">caster_conm_config_t</span></code> es una estructura que define la configuración de la comunicación. Consta de los siguientes miembros públicos:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*ip</span></code> la dirección del modulo (el caster se comunica con el módulo).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uint16_t</span> <span class="pre">caster_id</span></code> un valor que identifica inequivocamente al caster.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">caster_comm_mode_e</span> <span class="pre">caster_comm_mode</span></code> un valor de la enumeración que caracteriza el modo de comunicación. Este puede tomar los valores:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">CASTER_MODE_TX</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CASTER_MODE_TX</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CASTER_MODE_SPLMNT</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CASTER_MODE_POTI</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CASTER_MODE_MAX</span></code></p></li>
</ul>
</li>
</ul>
<p>Por otra parte, la función <code class="docutils literal notranslate"><span class="pre">us_caster_init()</span></code> inicia el contexto del caster.</p>
<p>Tanto la estructura como esta última función están definidas en <code class="docutils literal notranslate"><span class="pre">us_caster_service.h</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">caster_comm_config_t</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{.</span><span class="n">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="p">.</span><span class="n">caster_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">caster_comm_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CASTER_MODE_TX</span><span class="p">};</span>

<span class="n">us_caster_init</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="conexion-con-el-servicio-v2xcast">
<h3>Conexión con el servicio V2Xcast<a class="headerlink" href="#conexion-con-el-servicio-v2xcast" title="Link to this heading">¶</a></h3>
<p>Otro de los servicios proporcionado por <code class="docutils literal notranslate"><span class="pre">us_caster_service.h</span></code> es la función <code class="docutils literal notranslate"><span class="pre">us_caster_create()</span></code>. Esta función crea una instancia del caster y levanta los recursos necesarios para su funcionamiento.</p>
<p>En caso de devolver un código de error, se indicaria que no se es capaz de crear la conexión con el módulo (recordar que el caster se encarga de la comunicación pc-módulo) y termina con la ejecución del programa.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">us_caster_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">caster_handler</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">IS_SUCCESS</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Cannot link to V2Xcast Service, V2Xcast Service create ret: [%d]!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Please confirm network connection by pinging the Unex device then upload a V2Xcast config to create a V2Xcast Service.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">printf</span><span class="p">(</span><span class="s">&quot;-----------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="lectura-de-datos-del-usuario">
<h3>Lectura de datos del usuario<a class="headerlink" href="#lectura-de-datos-del-usuario" title="Link to this heading">¶</a></h3>
<p>Seguidamente, se procede a solicitar el usuario la información (<code class="docutils literal notranslate"><span class="pre">string</span></code>) a transmitir, y se hace todo el procesado. Esto se hace mediante la función <code class="docutils literal notranslate"><span class="pre">read_user_input()</span></code>. En caso de recibir una respuesta negativa, se termina la ejecución del programa.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">input_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_user_input</span><span class="p">(</span><span class="n">input_string</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">input_string</span><span class="p">));</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input_length</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="transmision-de-los-datos">
<h3>Transmisión de los datos<a class="headerlink" href="#transmision-de-los-datos" title="Link to this heading">¶</a></h3>
<p>Una vez se tiene la información a transmitir, se realiza la propia transmisión mediante la función <code class="docutils literal notranslate"><span class="pre">transmit_data()</span></code> previamente introducida. Si se produce algún error en la transmisión (<code class="docutils literal notranslate"><span class="pre">ret</span> <span class="pre">!=0</span></code>), no se termina la ejecución del programa pero se notifica del error por pantalla.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transmit_data</span><span class="p">(</span><span class="n">input_string</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error transmitting data.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="configuracion-de-los-hilos-de-tranmision">
<h3>Configuración de los hilos de tranmisión<a class="headerlink" href="#configuracion-de-los-hilos-de-tranmision" title="Link to this heading">¶</a></h3>
<p>A continuación, a través previamente explicada <code class="docutils literal notranslate"><span class="pre">app_set_thread_name_and_priority()</span></code>, se configuran los hilos de la forma deseada. La función <code class="docutils literal notranslate"><span class="pre">us_caster_thread_info_get()</span></code> obtiene la información necesaria del caster (es una función de la API) y deposita esa información en la variable que se le pasa como parámetro y que está definida al principio de <code class="docutils literal notranslate"><span class="pre">main</span></code>: <code class="docutils literal notranslate"><span class="pre">caster_thread_info</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">us_caster_thread_info_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">caster_thread_info</span><span class="p">);</span>
<span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app_set_thread_name_and_priority</span><span class="p">(</span><span class="n">pthread_self</span><span class="p">(),</span><span class="w"> </span><span class="n">APP_THREAD_TX</span><span class="p">,</span><span class="w"> </span><span class="n">caster_thread_info</span><span class="p">.</span><span class="n">tx_thread_name</span><span class="p">,</span><span class="w"> </span><span class="n">caster_thread_info</span><span class="p">.</span><span class="n">tx_thread_priority_low</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="liberacion-de-recursos">
<h3>Liberación de recursos<a class="headerlink" href="#liberacion-de-recursos" title="Link to this heading">¶</a></h3>
<p>Se libera la instancia del caster que habia creado así como las recursos utilizados por dicha instancia. Para ello, se hace uso de la función <code class="docutils literal notranslate"><span class="pre">us_caster_realease()</span></code> de la API del SDK.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">us_caster_release</span><span class="p">(</span><span class="n">caster_handler</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="limpieza-de-senales">
<h3>Limpieza de señales<a class="headerlink" href="#limpieza-de-senales" title="Link to this heading">¶</a></h3>
<p>Se desinicializa el contexto iniciado para la creación del caster mediante la función <code class="docutils literal notranslate"><span class="pre">us_caster_deinit()</span></code> de la API del SDK.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">us_caster_deinit</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="finalizacion-de-senales">
<h3>Finalización de señales<a class="headerlink" href="#finalizacion-de-senales" title="Link to this heading">¶</a></h3>
<p>Por último, se desactiva y limpian los recursos usando por la pila alternativa para el manejo de señales. En el caso de que todo se haya ejecutado correctamente, se proporcional la salida correspondiente <code class="docutils literal notranslate"><span class="pre">EXIT_SUCESS</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">app_teardown_signal</span><span class="p">();</span>
<span class="k">return</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="p">;</span>
</pre></div>
</div>
<p>A continuación, se muestra la función <code class="docutils literal notranslate"><span class="pre">main</span></code> completa.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">caster_thread_info_t</span><span class="w"> </span><span class="n">caster_thread_info</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>

<span class="w">    </span><span class="n">setbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argc</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Usage:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  ./data_transmitter [IP] [caster_rx_id] </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;  For example,</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;    ./data_transmitter 192.168.1.3 1&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">caster_rx_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

<span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app_setup_signals</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Failed to set up signals</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">caster_comm_config_t</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{.</span><span class="n">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="p">.</span><span class="n">caster_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">caster_comm_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CASTER_MODE_TX</span><span class="p">};</span>

<span class="w">    </span><span class="n">us_caster_init</span><span class="p">();</span>

<span class="w">    </span><span class="cm">/* init v2xcast */</span>
<span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">us_caster_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">caster_handler</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">IS_SUCCESS</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Cannot link to V2Xcast Service, V2Xcast Service create ret: [%d]!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">);</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Please confirm network connection by pinging the Unex device then upload a V2Xcast config to create a V2Xcast Service.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;-----------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* thread of data transmitter */</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">input_string</span><span class="p">[</span><span class="n">MAX_BUFFER_SIZE</span><span class="p">];</span><span class="w"> </span><span class="c1">// Buffer to hold user input</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">input_length</span><span class="p">;</span>

<span class="w">    </span><span class="n">input_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_user_input</span><span class="p">(</span><span class="n">input_string</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">input_string</span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input_length</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transmit_data</span><span class="p">(</span><span class="n">input_string</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error transmitting data.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/* If the example is run in Unex device, please use the below functions to set tx and rx message threads name and priority */</span>
<span class="w">    </span><span class="cm">/* If the example is run on other platforms, it is optional to set tx and rx message threads name and priority */</span>
<span class="w">    </span><span class="n">us_caster_thread_info_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">caster_thread_info</span><span class="p">);</span>
<span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app_set_thread_name_and_priority</span><span class="p">(</span><span class="n">pthread_self</span><span class="p">(),</span><span class="w"> </span><span class="n">APP_THREAD_TX</span><span class="p">,</span><span class="w"> </span><span class="n">caster_thread_info</span><span class="p">.</span><span class="n">tx_thread_name</span><span class="p">,</span><span class="w"> </span><span class="n">caster_thread_info</span><span class="p">.</span><span class="n">tx_thread_priority_low</span><span class="p">);</span>

<span class="w">    </span><span class="n">us_caster_release</span><span class="p">(</span><span class="n">caster_handler</span><span class="p">);</span>

<span class="w">    </span><span class="n">us_caster_deinit</span><span class="p">();</span>

<span class="w">    </span><span class="n">app_teardown_signal</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="basic.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Comunicación básica y personalizada</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Aitor Pascual
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Entiendo <cite>data_transmitter_main.c</cite></a><ul>
<li><a class="reference internal" href="#cabecera">Cabecera</a></li>
<li><a class="reference internal" href="#funciones">Funciones</a><ul>
<li><a class="reference internal" href="#leer-input-del-usuario">Leer input del usuario</a></li>
<li><a class="reference internal" href="#transmision-de-la-informacion">Transmisión de la información</a></li>
<li><a class="reference internal" href="#funcion-de-recepcion-de-senales">Función de recepción de señales</a></li>
<li><a class="reference internal" href="#configuracion-de-recepcion-de-senales-con-pila-alternativa">Configuración de recepción de señales con pila alternativa</a></li>
<li><a class="reference internal" href="#desactivacion-y-limpieza-de-recursos-asociados-a-la-recepcion-de-senales-con-pila-alternativa">Desactivación y limpieza de recursos asociados a la recepción de señales con pila alternativa</a></li>
<li><a class="reference internal" href="#configuracion-del-nombre-y-prioridad-del-hilo">Configuración del nombre y prioridad del hilo</a></li>
</ul>
</li>
<li><a class="reference internal" href="#funcion-principal">Función principal</a><ul>
<li><a class="reference internal" href="#invocar-el-programa">Invocar el programa</a></li>
<li><a class="reference internal" href="#configuracion-de-las-senales">Configuración de las señales</a></li>
<li><a class="reference internal" href="#configuracion-e-inicializacion-del-caster">Configuración e inicialización del caster</a></li>
<li><a class="reference internal" href="#conexion-con-el-servicio-v2xcast">Conexión con el servicio V2Xcast</a></li>
<li><a class="reference internal" href="#lectura-de-datos-del-usuario">Lectura de datos del usuario</a></li>
<li><a class="reference internal" href="#transmision-de-los-datos">Transmisión de los datos</a></li>
<li><a class="reference internal" href="#configuracion-de-los-hilos-de-tranmision">Configuración de los hilos de tranmisión</a></li>
<li><a class="reference internal" href="#liberacion-de-recursos">Liberación de recursos</a></li>
<li><a class="reference internal" href="#limpieza-de-senales">Limpieza de señales</a></li>
<li><a class="reference internal" href="#finalizacion-de-senales">Finalización de señales</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=9c9b61ad"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/translations.js?v=f85f4cfb"></script>
    </body>
</html>