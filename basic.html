<!doctype html>
<html class="no-js" lang="es" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Índice" href="genindex.html" /><link rel="search" title="Búsqueda" href="search.html" /><link rel="next" title="Entiendo data_transmitter_main.c" href="data-transmitter.html" /><link rel="prev" title="J2735" href="unex-j2735.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Comunicación básica y personalizada - documentación de Maqueta V2X - 0.1</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">documentación de Maqueta V2X - 0.1</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">documentación de Maqueta V2X - 0.1</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Búsqueda" name="q" aria-label="Búsqueda">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="project.html">El proyecto</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="unex.html">Los módulos Unex</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Los módulos Unex</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="unex-overview.html">Descripción general</a></li>
<li class="toctree-l2"><a class="reference internal" href="unex-v2xcast.html">V2Xcast</a></li>
<li class="toctree-l2"><a class="reference internal" href="unex-j2735.html">J2735</a></li>
</ul>
</li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Comunicación básica y personalizada</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-transmitter.html">Entiendo <cite>data_transmitter_main.c</cite></a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/basic.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="comunicacion-basica-y-personalizada">
<h1>Comunicación básica y personalizada<a class="headerlink" href="#comunicacion-basica-y-personalizada" title="Link to this heading">¶</a></h1>
<p>Este capítulo proporciona las instrucciones necesarias para iniciar y configurar la maqueta V2X más básicas utilizando el SDK proporcionado por el proveedor de los módulos V2X comprados por el grupo I2T, <a class="reference external" href="https://unex.com.tw/en/product/">Unex</a>.</p>
<p>En primer lugar, lugar se va a poner en marcha la comunicación entre dos módulos V2X que intercambiarán mensajes BSM (<em>Basis Safety Message</em>). En segundo lugar, haremos uso de V2X para intercambiar mensajes personalizados, fueras de los estándares de seguridad vehicular.</p>
<p>Para trabajar con los módulos Unex, en primera instancia, haremos uso del <strong>Entorno de desarrollo y soporte</strong> proporcionado junto al <em>hardware</em> de los propios módulos V2X. En este entorno se encuentra el siguiente material.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>v200/v2x-files/
├── BSP
├── DOC
├── LTS
└── SDK
4 directories, 0 files
</pre></div>
</div>
<ol class="arabic simple">
<li><p><strong>Board Support Package (BSP).</strong> Donde se encuentran configuraciones, <em>drivers</em> y herramientas necesarias para interactuar con <em>hardware</em> específico.</p></li>
<li><p><strong>Documentation (DOC).</strong> Donde se encuentran manuales y documentos básicos sobre los módulos utilizados y otro equipamiento Unex de la familia.</p></li>
<li><p><strong>Long Term Support (LTS).</strong> Donde se encuentran archivos relacionados con una versión de soporte a largo plazo, como actualizaciones, parches o configuraciones para garantizar la estabilidad.</p></li>
<li><p><strong>Software Development Kit (SDK).</strong> Incluye herramientas para trabajar con los módulos con bibliotecas, ejemplos de código y otros recursos para el desarrollo de <em>software</em> relacionado con el sistema. En este caso, la versión es la <code class="docutils literal notranslate"><span class="pre">v.200</span></code>.</p></li>
</ol>
<section id="comunicacion-basica">
<h2>Comunicacion básica<a class="headerlink" href="#comunicacion-basica" title="Link to this heading">¶</a></h2>
<div class="admonition-objetivo admonition">
<p class="admonition-title"><strong>Objetivo</strong></p>
<p>Poner en marcha una primera comunicación entre dos módulos V2X, creando una pequeña red celular C-V2X de tipo V2V. Para ello, intercambiar mensajes BSM.</p>
</div>
<p>Para llevar a cabo este objetivo se hara uso del SDK, que proporciona formatos de mensaje previamente configurados y ejemplos. Esto permite abstraerse en este ejercicio del contenido de la informacíón intercambiada.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La documentación general viene en formato <code class="docutils literal notranslate"><span class="pre">html</span></code> y se puede encontrar en <code class="docutils literal notranslate"><span class="pre">v200/v2x-files/DOC/index.html</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>find<span class="w"> </span>v200/v2x-files/<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;index.html&quot;</span>
<span class="go">./DOC/index.html</span>
</pre></div>
</div>
<p>En el apartado <em>4. Application Note</em> del capítulo <em>V2Xcast</em>, se describe qué tipos de mensajes se estandarizan tanto en EU (Unión Europea) como en US (United States). No obstante, no es de demasiado interés ya que el objetivo de este este proyecto se basa en una comunicación personalizada.</p>
<p>Existe cierta correspondencia entre esta descripción y el apartado <em>1. Quick Start Guide</em> de la sección <em>V2Xcast</em> de la documentación oficial de Unex.</p>
</div>
<p>Para el <strong>modulo transmisor</strong>, haremos uso del siguiente material</p>
<ol class="arabic simple">
<li><p>Un modulo Unex C-V2X/802.11p con su respectivo adaptador USB.</p></li>
<li><p>Una VM (máquina virtual) con Ubuntu 22.04.3 LTS (codename: <em>Jammy</em>) y arquitectura CPU <strong>x86_64</strong> gestionada por VirtualBox.</p></li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Para que la VM pueda reconocer el módulo, es necesario agregar un filtro de dispositivos USB en la configuración.</p>
</div>
<div class="admonition-que-tipo-de-arquitectura-tiene-mi-equipo admonition">
<p class="admonition-title">¿Qué tipo de arquitectura tiene mi equipo?</p>
<p>En Linux, para saber que tipo de arquitectura se tiene tan sólo se debe ejecutar <code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-m</span></code> sobre una terminal. Las respuestas típicas son: <code class="docutils literal notranslate"><span class="pre">x86_64</span></code> (x86 de 64 bits), <code class="docutils literal notranslate"><span class="pre">armv7_hf</span></code> (ARM de 32 bits) y <code class="docutils literal notranslate"><span class="pre">armv8_64</span></code> (ARM de 64 bits).</p>
</div>
<section id="pasos-a-seguir-en-el-modulo-transmisor">
<h3>Pasos a seguir en el módulo transmisor<a class="headerlink" href="#pasos-a-seguir-en-el-modulo-transmisor" title="Link to this heading">¶</a></h3>
<p>Dentro de la VM de Ubuntu, colocamos los ficheros del entorno de desarrollo, <code class="docutils literal notranslate"><span class="pre">BSM</span></code>, <code class="docutils literal notranslate"><span class="pre">DOC</span></code>, <code class="docutils literal notranslate"><span class="pre">LTS</span></code> y <code class="docutils literal notranslate"><span class="pre">SDK</span></code> en un directorio deseado.</p>
<section id="descomprimir-el-sdk">
<span id="descomprimir-sdk"></span><h4>Descomprimir el SDK<a class="headerlink" href="#descomprimir-el-sdk" title="Link to this heading">¶</a></h4>
<p>Dentro de la carpeta <code class="docutils literal notranslate"><span class="pre">SDK</span></code>, encontramos varios fichero <code class="docutils literal notranslate"><span class="pre">.tar</span></code>. Cada uno de ellos corresponde con un tipo de arquitectura de CPU. Para ello, se deberá extraer el fichero correspondiente a cada caso. Al descomprimir, tendremos las herramientas proporcionadas por el SDK disponibles.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>SDK/
<span class="gp">$ </span>tar<span class="w"> </span>zxvf<span class="w"> </span>us_v2xcast_sdk-x86_64_linux-v2.0.1.tgz
</pre></div>
</div>
<p>Dentro de este directorio encontramos los siguiente:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>us_v2xcast_sdk
├── bin
├── demo_certificates
├── example
├── inc
├── lib
├── sh
├── tool
└── VERSION.txt

7 directories, 1 file
</pre></div>
</div>
</section>
<section id="compilar-los-ficheros-de-ejemplo">
<span id="compilar-ejemplos"></span><h4>Compilar los ficheros de ejemplo<a class="headerlink" href="#compilar-los-ficheros-de-ejemplo" title="Link to this heading">¶</a></h4>
<p>Para este ejercicio vamos a hacer uso de los ejemplos de la carpeta <code class="docutils literal notranslate"><span class="pre">example</span></code>, donde se alojan varios directorio que incluyen ficheros <code class="docutils literal notranslate"><span class="pre">.c</span></code> asociados a las interacciones de diferentes tipos de mensajes estándarizados.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>example
├── libj2735msg
├── Makefile
├── v2xcast_bsm
├── v2xcast_event_detector_us
├── v2xcast_map
├── v2xcast_multiple_subscrible_us
├── v2xcast_probe_data_collection
├── v2xcast_rtcm
├── v2xcast_rtk_application_us
├── v2xcast_spat
├── v2xcast_static_memory_usage_us
├── v2xcast_tim
├── v2xcast_traffic_signal_detector_us
├── v2xcast_tsp
└── v2xcast_txrx_us

14 directories, 1 file
</pre></div>
</div>
<p>Al ejecutar <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> estaremos compilando todos estos ficheros en la VM.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>us_v2xcast_sdk/example
<span class="gp">$ </span>make
<span class="go">Users shall select the platform at the first execution</span>
<span class="go">1. x86_64, 2. armv7_hf, 3. armv8_64, 4. vtx351, 5. vtx352 (type range: 1 ~ 5): 1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Por defecto, <code class="docutils literal notranslate"><span class="pre">make</span></code> guardara este valor en memoria para no tener que volver a ser introducido. En caso de querer recompilar estos fichero para otras arquitecturas se puede volver al estado inicial mediante <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">make</span> <span class="pre">reset</span></code>.</p>
</div>
</section>
<section id="preparar-el-servicio-v2xcast-en-el-modulo">
<h4>Preparar el servicio V2Xcast en el modulo<a class="headerlink" href="#preparar-el-servicio-v2xcast-en-el-modulo" title="Link to this heading">¶</a></h4>
<p>Una vez tenemos los ficheros preparados, debemos configurar el modulo para la transmisión.</p>
<p>El intercambio de información entre el host (VM) y el módulo se lleva a cabo mediante paquetes <code class="docutils literal notranslate"><span class="pre">IP</span></code> sobre <code class="docutils literal notranslate"><span class="pre">USB</span></code> haciendo uso la tecnologia <code class="docutils literal notranslate"><span class="pre">RNDIS/NCM</span></code>. Esta tecnologia es transparente para la gestión del módulo. No obstante, es útil entender porque las comunicaciones host-módulo se ejecutan mediante protocolos y herramientas de red.</p>
<div class="admonition-que-es-la-tencologia-rndis-ncm admonition">
<p class="admonition-title">¿Que es la tencología RNDIS/NCM?</p>
<p>Por un lado, RNDIS (<em>Remote Network Drive Interface Specification</em>) permite que un dispositivo actue como una interfaz de red virtual a través de USB, creando una conexión similar a Ethernet. Por otro lado, NCM (<em>Network Control Model</em>) es un estándar más eficiente desarrollado por <code class="docutils literal notranslate"><span class="pre">USB-IF</span></code> para transferencias de datos en redes a través de USB, diseñado para maximizar la velocidad.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Antes de configurar directamente el servicio V2Xcast, debemos comprobar que existe conectividad con el módulo. Para ello, simplemente verificamos que se puede llevar a cabo un <code class="docutils literal notranslate"><span class="pre">ping</span></code>. El módulo, por defecto, el módulo se asigna a sí mismo la dirección <code class="docutils literal notranslate"><span class="pre">192.168.1.3</span></code>.</p>
</div>
<p>Para crear el servicio V2Xcast, debemos subir un fichero <code class="docutils literal notranslate"><span class="pre">.json</span></code> con las características de la comunicación deseada. En el caso de este primer ejemplo, el fichero está ya preparado y se encuentra en <code class="docutils literal notranslate"><span class="pre">us_v2xcast_sdk/bin/bsm_adhoc.json</span></code>. Por tanto, sólo debemos subirlo al módulo. Esto se puede realizar a través del programa <code class="docutils literal notranslate"><span class="pre">v2xcast_manager</span></code> proporcionado en el SDK. Este programa incorpora herramientas de red y facilita la gestión del módulo.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>us_v2xcast_sdk/bin
<span class="gp">$ </span>./<span class="w"> </span>v2xcast_manager<span class="w"> </span>-m<span class="w"> </span>post<span class="w"> </span>-f<span class="w"> </span>./cv2x/bsm_adhoc.json<span class="w"> </span><span class="m">192</span>.168.1.3/cfg/v2xcast
<span class="go">Uploading US V2Xcast config successful</span>
</pre></div>
</div>
</section>
<section id="transmicion-periodica">
<h4>Transmición periódica<a class="headerlink" href="#transmicion-periodica" title="Link to this heading">¶</a></h4>
<p>Para comenzar a realizar una transmisión periódica de mensaje BSM, tan sólo debemos ejecutar los correspondientes fichero <code class="docutils literal notranslate"><span class="pre">.c</span></code> que previamente hemos compilado. A estos, le debemos pasar como parámetros la dirección de comunicación del módulo (<code class="docutils literal notranslate"><span class="pre">192.168.1.3</span></code>), el rol que toma el módulo (<code class="docutils literal notranslate"><span class="pre">0</span></code> para recibir, <code class="docutils literal notranslate"><span class="pre">1</span></code> para enviar) y un <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>us_v2xcast_sdk/example/v2xcast_bsm
<span class="gp">$ </span>./v2xcast_bsm<span class="w"> </span><span class="m">192</span>.168.1.3<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
<p>Una vez el módulo está transmitiendo el resultado esperado es el siguiente:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>connect to server 192.168.1.3:30001 with identity v2xcast_bsm@12-23 06:24:49
-----------------------
Index 0, token {
      &quot;id&quot;: &quot;abcd&quot;,
      &quot;tractionControlStatus&quot;: 3,
      &quot;antiLockBrakeStatus&quot;: 3,
      &quot;stabilityControlStatus&quot;: 3,
      &quot;vehicleSafetyExtensions&quot;: {
        &quot;option&quot;: 1,
        &quot;rightTurnSignalOn&quot;: 1,
        &quot;leftTurnSignalOn&quot;: 0
      },
      &quot;specialVehicleExtensions&quot;: {
        &quot;option&quot;: 1,
        &quot;lightBarInUse&quot;: 1,
        &quot;sirenInUse&quot;: 2
      }
    }
BSM id: abcd, tractionControlStatus: 3, antiLockBrakeStatus: 3, stabilityControlStatus: 3, vehicleSafetyExtensions_option: 1, rightTurnSignalOn: 1, leftTurnSignalOn: 0, specialVehicleExtensions_option: 1,lightBarInUse: 1, sirenInUse: 2
message count 1

coreData.secMark: 50700
coreData.long: 121.035425
coreData.lat: 24.808811
12-23 06:24:50.779  6254  6257 D J2735 UPER_ENCODE

encode successfully
BSM encoded data:

00 14 33 40 58 58 98 D9 31 83 22 37 37 97 59 B7
2E 26 08 00 00 00 00 00 00 00 00 00 7E 7D 07 D0
7F 7F FF 17 E0 00 00 01 00 1D 64 00 20 F9 D9 02
00 10 34 20 88 20

Transmitted 54 bytes!
-----------------------
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Los módulos deben tener conectadas tres antenas para que se de lugar a la comunicación. En especial, la antena que recoge información de la posición (GNSS), debe tener visión directa con los satelites del sistema. Por tanto, es fundamental que los dispositivos se encuentre en espacios abierto (fuera de la ventana de un edificio, en la calle, etc.).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Destacar que en esta transmisión las llamadas a la API del SDK que realizan los ficheros <code class="docutils literal notranslate"><span class="pre">.c</span></code> se ejecutan directamente sobre la VM de Linux y <strong>NO</strong> sobre el módulo.</p>
</div>
</section>
</section>
<section id="pasos-a-seguir-en-el-modulo-receptor">
<h3>Pasos a seguir en el módulo receptor<a class="headerlink" href="#pasos-a-seguir-en-el-modulo-receptor" title="Link to this heading">¶</a></h3>
<p>Para el <strong>modulo receptor</strong>, haremos uso del siguiente material.</p>
<ol class="arabic simple">
<li><p>Un módulo Unec C-V2X/802.11p con su respectivo adaptador USB.</p></li>
<li><p>Una Raspberry Pi con Rapsbian y arquitectura CPU <strong>armv7_hf</strong>.</p></li>
</ol>
<p>En la Raspberry Pi, colocamos los ficheros del entorno de desarrollo, <code class="docutils literal notranslate"><span class="pre">BSM</span></code>, <code class="docutils literal notranslate"><span class="pre">DOC</span></code>, <code class="docutils literal notranslate"><span class="pre">LTS</span></code> y <code class="docutils literal notranslate"><span class="pre">SDK</span></code> en un directorio deseado.</p>
<p>Los pasos a seguir son similares al caso del transmisor. En primer lugar debemos <a class="reference internal" href="#descomprimir-sdk"><span class="std std-ref">Descomprimir el SDK</span></a>. En segundo lugar, <a class="reference internal" href="#compilar-ejemplos"><span class="std std-ref">Compilar los ficheros de ejemplo</span></a>. En este caso, estaremos compilando los ficheros en la Rapsberry Pi en lugar de la VM. Además, en lugar de seleccionar la opción <code class="docutils literal notranslate"><span class="pre">x86_64</span></code>, debemos selecionar <code class="docutils literal notranslate"><span class="pre">3</span></code> ya que hacemos uso de la arquitectura <code class="docutils literal notranslate"><span class="pre">armv7_hf</span></code>.</p>
<p>Sin embargo, la forma en la que preparamos el servicio V2Xcast en el módulo es diferente (por ser un sistema con arquitectura <em>armv7_hf</em>).</p>
<section id="id1">
<h4>Preparar el servicio V2Xcast en el módulo<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h4>
<p>Para subir el fichero <code class="docutils literal notranslate"><span class="pre">bsm_adhoc.json</span></code> y configurar el servicio (las características de la comunicación V2X) haremos uso de SCP (<em>Secure Copy Protocol</em>). Dado que el módulo tiene asignada la dirección <code class="docutils literal notranslate"><span class="pre">192.168.1.3</span></code>, podemos copiar de forma recursviva toda el contenido bajo <code class="docutils literal notranslate"><span class="pre">us_v2xcast_sdk</span></code> en el módulo.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>us_v2xcast_sdk/
<span class="gp">$ </span>scp<span class="w"> </span>-r<span class="w"> </span>us_v2xcast_sdk<span class="w"> </span>root@192.168.1.3:/home/unex
</pre></div>
</div>
<p>Posteriormente, nos conectaremos al módulo a través de SSH.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ssh<span class="w"> </span>root@192.168.1.3
<span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>/home/unex/us_v2xcast_sdk
</pre></div>
</div>
<p>Y ahora, desde el propio modulo, subiremos el fichero <code class="docutils literal notranslate"><span class="pre">bsm_adhoc.json</span></code> a través del propio gestor del SDK.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>./v2xcast_manager<span class="w"> </span>-m<span class="w"> </span>post<span class="w"> </span>-f<span class="w"> </span>./cv2x/bsd_adhoc.sjon
<span class="go">Uploading US V2Xcast config successful</span>
</pre></div>
</div>
</section>
<section id="recepcion">
<h4>Recepción<a class="headerlink" href="#recepcion" title="Link to this heading">¶</a></h4>
<p>Continuando el la consola del módulo mediante SSH, para preparar el módulo para la transmisión, tan sólo debemos ejecutar los ficheros <code class="docutils literal notranslate"><span class="pre">.c</span></code> compilados previamente para ello.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>/home/unex/us_v2xcast_sdk/example/v2xcast_bsm
<span class="go">./v2xcast_bsm 127.0.0.1 0 0</span>
</pre></div>
</div>
<p>El resultado, al recebir algun paquete, se espera que sea el siguiente:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>connect to server 127.0.0.1:30002
-----------------------
Received 54 bytes!
BSM decoding data:

00 14 33 40 18 58 98 D9 09 DC E2 37 51 D8 D9 B7
36 FE 08 00 00 00 00 00 00 00 00 00 7E 7D 07 D0
7F 7F FF 17 E0 00 00 01 00 1D 64 00 20 F9 D9 02
00 10 34 20 88 20

Decoded BSM
  coreData.msgCnt: 1
  coreData.id: 61626364
  secMark: 10099
  transmission: 0
  partII[0]:
    partII_Id: 0
     case VehicleSafetyExt: 3
  partII[1]:
    partII_Id: 1
-----------------------
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Los módulos deben tener conectadas tres antenas para que se de lugar a la comunicación. En especial, la antena que recoge información de la posición (GNSS), debe tener visión directa con los satelites del sistema. Por tanto, es fundamental que los dispositivos se encuentre en espacios abierto (fuera de la ventana de un edificio, en la calle, etc.).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Destacar que en esta recepción las llamadas a la API del SDK que realizan los ficheros <code class="docutils literal notranslate"><span class="pre">.c</span></code> se ejecutan sobre el módulo y <strong>NO</strong> sobre la Raspeberry Pi. Esto puede llegar a suponer un obstáculo ya que las capacidad del módulo es limidada (se trata de un sistema embebido).</p>
</div>
</section>
</section>
</section>
<section id="comunicacion-personalizada">
<h2>Comunicación personalizada<a class="headerlink" href="#comunicacion-personalizada" title="Link to this heading">¶</a></h2>
<div class="admonition-objetivo admonition">
<p class="admonition-title"><strong>Objetivo</strong></p>
<p>Poner en marcha una primera comunicación entre dos módulos V2X, creando una pequeña red celular C-V2X de tipo V2V. Para ello, intercambiar mensajes personalizados.</p>
</div>
<section id="entendiendo-la-transmision-y-la-recepcion">
<h3>Entendiendo la transmisión y la recepción<a class="headerlink" href="#entendiendo-la-transmision-y-la-recepcion" title="Link to this heading">¶</a></h3>
<p>Despues de entender el contenido del fichero <code class="docutils literal notranslate"><span class="pre">v2xcast_bsm.c</span></code> del SDK, se ha compredido la manera de transmitir la información. Dicho código utiliza un punto de la API <em>hardware</em> que recibe diferentes parámetros entre los cuales se encuentra el dato a transmitir. Por otra parte, el modulo receptor, realiza un bucle sobre otro punto de la API que se encarga de gestionar la recepción de la recepción.</p>
<div class="admonition tip">
<p class="admonition-title">Truco</p>
<p>La información acerca de la API del SDK se puede encontrar en el apartado <em>2. US V2Xcast</em>; en concreto, <em>2.5 V2Xcast API</em>. También se puede encontrar información acerca de los <em>casters</em> que son los encargados de gestionar la transmisión y la recepción, entre otros.</p>
</div>
<p>Las funciones más relevantes en este aspecto son las siguientes.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.us_caster_tx">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">us_caster_tx</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">caster_handler_t</span></span><span class="w"> </span><span class="n"><span class="pre">caster_handler</span></span>, <span class="n"><span class="pre">us_caster_tx_info_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tx_info</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buf</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">len</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.us_caster_tx" title="Link to this definition">¶</a><br /></dt>
<dd><p>Transmite un mensaje V2X.</p>
<dl class="field-list simple">
<dt class="field-odd">Parámetros<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>caster_handler</strong> – [in] indica un manejador de caster creado.</p></li>
<li><p><strong>tx_info</strong> – [in] indica que se reemplacen las configuraciones predeterminadas con este tx_info. Si es NULL, se usan las configuraciones de TX del archivo JSON, de lo contrario, se usan las configuraciones de TX con los parámetros de tx_info.</p></li>
<li><p><strong>buf</strong> – [in] indica el mensaje a enviar.</p></li>
<li><p><strong>len</strong> – [in] indica el número de bytes a enviar, la longitud máxima del payload es de 1500 bytes. El tamaño de la transmisión puede superar los 1500 bytes después del procesamiento en capas inferiores. En este caso, el usuario debe reducir el tamaño del mensaje.</p></li>
</ul>
</dd>
<dt class="field-even">Devuelve<span class="colon">:</span></dt>
<dd class="field-even"><p>El estado de la API invocada. Consulte los VALORES DE RETORNO para más detalles.</p>
</dd>
<dt class="field-odd">Note<span class="colon">:</span></dt>
<dd class="field-odd"><p>El valor válido de los elementos de tx_info está descrito en los Elementos del Perfil y el Rango de Valores.</p>
</dd>
</dl>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.us_caster_rx">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">us_caster_rx</span></span></span><span class="sig-paren">(</span><span class="n"><span class="pre">caster_handler_t</span></span><span class="w"> </span><span class="n"><span class="pre">caster_handler</span></span>, <span class="n"><span class="pre">us_caster_rx_info_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">rx_info</span></span>, <span class="n"><span class="pre">uint8_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">buf</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">buf_size</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">len</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.us_caster_rx" title="Link to this definition">¶</a><br /></dt>
<dd><p>Recibe un mensaje V2X.</p>
<p>Esta API bloqueará hasta que se reciba el paquete.</p>
<dl class="field-list simple">
<dt class="field-odd">Parámetros<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>caster_handler</strong> – [in] indica un manejador de caster creado.</p></li>
<li><p><strong>rx_info</strong> – [out] se utiliza para recibir la información de rx_info.</p></li>
<li><p><strong>buf</strong> – [out] se utiliza para recibir el mensaje.</p></li>
<li><p><strong>buf_size</strong> – [in] tamaño del búfer de entrada.</p></li>
<li><p><strong>len</strong> – [out] indica el número de bytes recibidos.</p></li>
</ul>
</dd>
<dt class="field-even">Devuelve<span class="colon">:</span></dt>
<dd class="field-even"><p>El estado de la API invocada.</p>
</dd>
</dl>
</dd></dl>

<p>De estas dos funciones, lo que maś compete a este ejercicio es la variable <code class="docutils literal notranslate"><span class="pre">buf</span></code>. Es donde se deben incluir los datos a enviar en la transmisión, y donde se recibirán, en la recepción.</p>
</section>
<section id="tranmision-de-un-string">
<h3>Tranmisión de un string<a class="headerlink" href="#tranmision-de-un-string" title="Link to this heading">¶</a></h3>
</section>
<section id="tranmision-de-un-video">
<h3>Tranmisión de un video<a class="headerlink" href="#tranmision-de-un-video" title="Link to this heading">¶</a></h3>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="data-transmitter.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Entiendo <cite>data_transmitter_main.c</cite></div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="unex-j2735.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">J2735</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Aitor Pascual
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Comunicación básica y personalizada</a><ul>
<li><a class="reference internal" href="#comunicacion-basica">Comunicacion básica</a><ul>
<li><a class="reference internal" href="#pasos-a-seguir-en-el-modulo-transmisor">Pasos a seguir en el módulo transmisor</a><ul>
<li><a class="reference internal" href="#descomprimir-el-sdk">Descomprimir el SDK</a></li>
<li><a class="reference internal" href="#compilar-los-ficheros-de-ejemplo">Compilar los ficheros de ejemplo</a></li>
<li><a class="reference internal" href="#preparar-el-servicio-v2xcast-en-el-modulo">Preparar el servicio V2Xcast en el modulo</a></li>
<li><a class="reference internal" href="#transmicion-periodica">Transmición periódica</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pasos-a-seguir-en-el-modulo-receptor">Pasos a seguir en el módulo receptor</a><ul>
<li><a class="reference internal" href="#id1">Preparar el servicio V2Xcast en el módulo</a></li>
<li><a class="reference internal" href="#recepcion">Recepción</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#comunicacion-personalizada">Comunicación personalizada</a><ul>
<li><a class="reference internal" href="#entendiendo-la-transmision-y-la-recepcion">Entendiendo la transmisión y la recepción</a></li>
<li><a class="reference internal" href="#tranmision-de-un-string">Tranmisión de un string</a></li>
<li><a class="reference internal" href="#tranmision-de-un-video">Tranmisión de un video</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=9c9b61ad"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/translations.js?v=f85f4cfb"></script>
    </body>
</html>